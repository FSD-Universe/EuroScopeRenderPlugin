# 渲染插件配置文件说明

配置文件为 YAML 格式，默认文件名 `config.yaml`，需放在插件 DLL 同目录或指定路径。

## 顶层结构

| 字段           | 类型 | 必填 | 说明                                 |
|--------------|----|----|------------------------------------|
| **color**    | 对象 | 是  | 颜色名称 → 十六进制颜色，供 `features` 中通过名称引用 |
| **features** | 数组 | 是  | 要绘制的要素列表，每项为一种几何或文字                |

---

## color（颜色表）

键为颜色名称（英文），值为颜色字符串：

| 格式          | 示例            | 说明               |
|-------------|---------------|------------------|
| `#RRGGBB`   | `"#FF0000"`   | 红绿蓝，不透明          |
| `#RGB`      | `"#F00"`      | 简写，等价于 `#FF0000` |
| `#RRGGBBAA` | `"#FF000080"` | 带透明度             |

在 `features` 的 `fill`、`color` 中可写名称（如 `red`）或直接写十六进制（如 `"#FF0000"`）。

---

## features（要素列表）

每个要素为一个对象，**必填字段**：`type`、`coordinates`。

### 通用字段

| 字段              | 类型  | 默认 | 说明                                     |
|-----------------|-----|----|----------------------------------------|
| **type**        | 字符串 | -  | 要素类型：`line`（线段）、`area`（多边形）、`text`（文字） |
| **coordinates** | 数组  | -  | 坐标数组，每项为 `[经度, 纬度]`                    |
| **zoom**        | 整数  | 0  | 最小缩放等级（1–19），当前等级小于此值时不绘制；0 表示任意等级都绘制  |
| **color**       | 字符串 | -  | 线段/边框/文字颜色：颜色名称或 `#RRGGBB`；area 不填则无边框 |

### 线段 (line) 专用

| 字段                         | 类型           | 默认            | 说明                                           |
|----------------------------|--------------|---------------|----------------------------------------------|
| **stroke** / **lineStyle** | 字符串          | `solid`       | 线型：`solid`（实线）、`dashed`（虚线），不区分大小写           |
| **strokeWidth**            | 浮点数          | 实线 1.0，虚线 2.0 | 线宽（像素）                                       |
| **dashLength**             | 浮点数          | 10.0          | 虚线时单段实线长度                                    |
| **gapLength**              | 浮点数          | 6.0           | 虚线时间隔长度                                      |
| **dash**                   | 数组 `[长, 间隔]` | -             | 虚线简写，如 `[8, 4]` 等价于 dashLength=8、gapLength=4 |

- `coordinates` 至少 2 个点，按顺序连成折线。

### 多边形 (area) 专用

| 字段                                        | 类型     | 默认            | 说明                    |
|-------------------------------------------|--------|---------------|-----------------------|
| **fill**                                  | 字符串    | -             | 填充颜色（名称或 `#RRGGBB`）   |
| **stroke** / **lineStyle**                | 字符串    | `solid`       | 边框线型：`solid`、`dashed` |
| **strokeWidth**                           | 浮点数    | 实线 1.0，虚线 2.0 | 边框线宽                  |
| **dashLength** / **gapLength** / **dash** | 同 line | -             | 边框为虚线时生效              |

- `coordinates` 至少 3 个点，首尾自动闭合。
- 仅填 `stroke: dashed` 不填 `color` 时，会以默认颜色画虚线边框。

### 文字 (text) 专用

| 字段                            | 类型  | 默认        | 说明                                                                         |
|-------------------------------|-----|-----------|----------------------------------------------------------------------------|
| **text**                      | 字符串 | -         | 显示内容，支持 UTF-8；支持多行：YAML 中可用 `\n` 或换行书写（如 `\|` 多行块）                         |
| **size**                      | 整数  | 12        | 字号（固定像素），不随缩放变化 |
| **textAnchor**                | 字符串 | `topLeft` | 控制点位置：`topLeft`、`topCenter`、`topRight`、`midLeft`、`center`、`midRight`、`bottomLeft`、`bottomCenter`、`bottomRight`（左上、上中、右上、左中、中、右中、左下、下中、右下） |
| **textBackground**            | 字符串 | -         | 文字背景色（颜色名称或 `#RRGGBB`）；不填则不绘制背景                                            |
| **textBackgroundStroke**      | 字符串 | -         | 文字背景框描边颜色（颜色名称或 `#RRGGBB`）；不填则不绘制边框；可与 textBackground 同时使用                 |
| **textBackgroundStrokeWidth** | 浮点数 | 2         | 文字背景框描边线宽（像素）                                                              |

- `coordinates` 取第一个点作为文字**控制点**，具体含义由 **textAnchor** 决定。
- 文字大小为固定像素（**size**），不随缩放等级变化。

---

## 缩放等级 (zoom)

- 标准地图缩放 **1–19**：数字越大视野越近。
- 要素的 **zoom** 表示「仅当当前缩放等级 ≥ 该值时才绘制」。
- 不写或写 `zoom: 0` 表示任意缩放都绘制。

---

## 插件设置（EuroScope 设置 → 插件）

在 EuroScope 的 **设置 → 插件** 中可为本插件配置以下项（键名即设置键）：

| 设置键                       | 默认值                | 说明                                                                 |
|---------------------------|--------------------|--------------------------------------------------------------------|
| **ConfigPath**            | `config.yaml`      | 渲染数据配置文件路径（相对插件 DLL 所在目录或绝对路径）                                     |
| **LogPath**               | `RenderPlugin.log` | 日志文件路径（相对插件 DLL 所在目录）                                              |
| **LogLevel**              | `off`              | 日志级别：`off`、`debug`、`info`、`warn`、`error` 等                         |
| **RenderType**            | `d2d`              | 渲染后端：`d2d`（Direct2D）或 `gdi`（GDI+）                                  |
| **TextSizeReferenceZoom** | `12`               | 文字 **size** 的参考缩放等级（1–19），该 zoom 下配置的 size 即对应参考像素。 |

---

## 示例摘要

```yaml
color:
  myRed: "#CC0000"

features:
  - type: line
    coordinates: [ [ 116.38, 39.89 ], [ 116.40, 39.90 ] ]
    color: myRed
    stroke: dashed
    strokeWidth: 2
    dash: [ 8, 4 ]
    zoom: 8

  - type: area
    coordinates: [ [ 116.39, 39.90 ], [ 116.41, 39.90 ], [ 116.41, 39.92 ], [ 116.39, 39.92 ] ]
    fill: "#EEEEEE"
    color: "#333333"
    stroke: dashed
    zoom: 10

  - type: text
    coordinates: [ [ 116.40, 39.91 ] ]
    text: "标签"
    size: 14
    textAnchor: center
    color: "#000000"
    zoom: 9
```

更多完整示例见 `config.example.yaml`。
